name: Run HubSpot Sign-In Test

on:
  workflow_dispatch:

jobs:
  run-signin-test:
    runs-on: ubuntu-latest

    env:
      GOOGLE_EMAIL_VANJA: ${{ secrets.GOOGLE_EMAIL_VANJA }}
      GOOGLE_PASSWORD_VANJA: ${{ secrets.GOOGLE_PASSWORD_VANJA }}
      GOOGLE_TOTPIN_VANJA: ${{ secrets.GOOGLE_TOTPIN_VANJA }}
      HUBSPOT_TOTPIN_VANJA: ${{ secrets.HUBSPOT_TOTPIN_VANJA }}
      CI: true  # Used to detect CI environment in your Java code

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up JDK
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip xvfb libxi6
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get -f install -y

    - name: Set up ChromeDriver
      run: |
        CHROME_VERSION=$(google-chrome --version | grep -oP '\d+\.\d+\.\d+')
        echo "Detected Chrome version: $CHROME_VERSION"
        wget https://chromedriver.storage.googleapis.com/${CHROME_VERSION}/chromedriver_linux64.zip || wget https://chromedriver.storage.googleapis.com/116.0.5845.96/chromedriver_linux64.zip
        unzip chromedriver_linux64.zip
        sudo mv chromedriver /usr/local/bin/
        chromedriver --version

    - name: Run SignInTest
      run: |
        chmod +x gradlew
        xvfb-run --auto-servernum --server-args='-screen 0 1920x1080x24' ./gradlew run
