name: Trigger

on:
  workflow_dispatch:

jobs:
  run-signin-test:
    runs-on: ubuntu-latest

    env:
      GOOGLE_EMAIL_VANJA: ${{ secrets.GOOGLE_EMAIL_VANJA }}
      GOOGLE_PASSWORD_VANJA: ${{ secrets.GOOGLE_PASSWORD_VANJA }}
      GOOGLE_TOTPIN_VANJA: ${{ secrets.GOOGLE_TOTPIN_VANJA }}
      HUBSPOT_TOTPIN_VANJA: ${{ secrets.HUBSPOT_TOTPIN_VANJA }}
      CI: true

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up JDK
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip xvfb libxi6
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get -f install -y

    - name: Download dependencies
      run: |
        mkdir -p lib

        # Selenium core modules
        wget -O lib/selenium-api.jar https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-api/4.16.1/selenium-api-4.16.1.jar
        wget -O lib/selenium-chrome-driver.jar https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-chrome-driver/4.16.1/selenium-chrome-driver-4.16.1.jar
        wget -O lib/selenium-chromium-driver.jar https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-chromium-driver/4.16.1/selenium-chromium-driver-4.16.1.jar
        wget -O lib/selenium-support.jar https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-support/4.16.1/selenium-support-4.16.1.jar
        wget -O lib/selenium-java.jar https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-java/4.16.1/selenium-java-4.16.1.jar

        # WebDriverManager
        wget -O lib/webdrivermanager.jar https://repo1.maven.org/maven2/io/github/bonigarcia/webdrivermanager/5.6.3/webdrivermanager-5.6.3.jar

        # Dotenv
        wget -O lib/dotenv.jar https://repo1.maven.org/maven2/io/github/cdimascio/java-dotenv/5.2.2/java-dotenv-5.2.2.jar

        # Aerogear OTP
        wget -O lib/aerogear-otp.jar https://repo1.maven.org/maven2/org/jboss/aerogear/aerogear-otp-java/1.0.0/aerogear-otp-java-1.0.0.jar

        # Guava (for Function interface used by ExpectedConditions)
        wget -O lib/guava.jar https://repo1.maven.org/maven2/com/google/guava/guava/32.1.2-jre/guava-32.1.2-jre.jar



    - name: Compile and run SignInTest
      run: |
        mkdir -p bin
        javac -d bin -cp "lib/*" src/main/java/com/spothopper/SignInTest.java
        xvfb-run --auto-servernum --server-args='-screen 0 1920x1080x24' \
          java -cp "bin:lib/*" com.spothopper.SignInTest
